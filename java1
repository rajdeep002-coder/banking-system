import java.sql.*;
import java.util.Scanner;

public class BankingSystem {

    
    static final String URL =
        "jdbc:mysql://127.0.0.1:3306/banking_db";
    static final String USER = "root";
    static final String PASS = "1234";

    static Connection con;
    static Scanner sc = new Scanner(System.in);

    
    public static void connect() {

        try {
            Class.forName("com.mysql.cj.jdbc.Driver");

            con = DriverManager.getConnection(
                    URL, USER, PASS);

            System.out.println("Connected to Database");

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    
    public static void createAccount() {

        try {

            System.out.print("Enter Name: ");
            String name = sc.nextLine();

            System.out.print("Enter Email: ");
            String email = sc.nextLine();

            System.out.print("Enter Balance: ");
            double bal = sc.nextDouble();
            sc.nextLine();

            String q =
                "INSERT INTO users(name,email,balance) VALUES(?,?,?)";

            PreparedStatement ps =
                con.prepareStatement(q);

            ps.setString(1, name);
            ps.setString(2, email);
            ps.setDouble(3, bal);

            ps.executeUpdate();

            System.out.println("Account Created!");

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

   
    public static void checkBalance() {

        try {

            System.out.print("Enter Account No: ");
            int acc = sc.nextInt();
            sc.nextLine();

            String q =
                "SELECT balance FROM users WHERE account_no=?";

            PreparedStatement ps =
                con.prepareStatement(q);

            ps.setInt(1, acc);

            ResultSet rs = ps.executeQuery();

            if (rs.next()) {
                System.out.println("Balance: " +
                        rs.getDouble(1));
            } else {
                System.out.println("Account Not Found");
            }

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    
    public static void transfer() {

        try {

            System.out.print("Sender Acc No: ");
            int sender = sc.nextInt();

            System.out.print("Receiver Acc No: ");
            int receiver = sc.nextInt();

            System.out.print("Amount: ");
            double amount = sc.nextDouble();
            sc.nextLine();

            con.setAutoCommit(false);

            
            PreparedStatement check =
                con.prepareStatement(
                "SELECT balance FROM users WHERE account_no=?");

            check.setInt(1, sender);

            ResultSet rs = check.executeQuery();

            if (!rs.next()) {
                throw new Exception("Sender Not Found");
            }

            double bal = rs.getDouble(1);

            if (bal < amount) {
                throw new Exception("Low Balance");
            }

           
            PreparedStatement withdraw =
                con.prepareStatement(
                "UPDATE users SET balance=balance-? WHERE account_no=?");

            withdraw.setDouble(1, amount);
            withdraw.setInt(2, sender);

            withdraw.executeUpdate();

           
            PreparedStatement deposit =
                con.prepareStatement(
                "UPDATE users SET balance=balance+? WHERE account_no=?");

            deposit.setDouble(1, amount);
            deposit.setInt(2, receiver);

            int d = deposit.executeUpdate();

            if (d == 0) {
                throw new Exception("Receiver Not Found");
            }

            con.commit();

            System.out.println("Transfer Successful!");

        } catch (Exception e) {

            try {
                con.rollback();
            } catch (Exception ex) {
                ex.printStackTrace();
            }

            System.out.println("Failed: " + e.getMessage());
        }
    }

    
    public static void main(String[] args) {

        connect();

        while (true) {

            System.out.println("\n--- BANKING SYSTEM ---");
            System.out.println("1. Create Account");
            System.out.println("2. Check Balance");
            System.out.println("3. Transfer Money");
            System.out.println("4. Exit");

            System.out.print("Enter Choice: ");
            int ch = sc.nextInt();
            sc.nextLine();

            switch (ch) {

                case 1:
                    createAccount();
                    break;

                case 2:
                    checkBalance();
                    break;

                case 3:
                    transfer();
                    break;

                case 4:
                    System.out.println("Thank You!");
                    System.exit(0);

                default:
                    System.out.println("Invalid Choice");
            }
        }
    }
}
